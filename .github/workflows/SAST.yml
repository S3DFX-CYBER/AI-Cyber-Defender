sast-scan:
  name: SAST Security Scanning
  runs-on: ubuntu-latest
  
  steps:
    - uses: actions/checkout@v6
    
    - name: Set up Python
      uses: actions/setup-python@v6
      with:
        python-version: '3.11'
    
    - name: Install security tools
      run: |
        pip install bandit safety semgrep
    
    # Bandit - Python SAST
    - name: Run Bandit SAST scan
      run: |
        bandit -r services/ scripts/ -f json -o bandit-report.json
        bandit -r services/ scripts/ -f screen
      continue-on-error: true
    
    # Safety - Dependency vulnerabilities
    - name: Run Safety dependency scan
      run: |
        safety check --json --output safety-report.json
        safety check
      continue-on-error: true
    
    # Semgrep - Advanced SAST
    - name: Run Semgrep scan
      run: |
        semgrep --config=auto services/ scripts/ --json -o semgrep-report.json
        semgrep --config=auto services/ scripts/
      continue-on-error: true
    
    - name: Upload security reports
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: sast-reports
        path: |
          bandit-report.json
          safety-report.json
          semgrep-report.json

# CodeQL Analysis (GitHub's built-in SAST)
codeql-analysis:
  name: CodeQL SAST Analysis
  runs-on: ubuntu-latest
  permissions:
    security-events: write
    
  steps:
    - uses: actions/checkout@v6
    
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v3
      with:
        languages: python
    
    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v3
